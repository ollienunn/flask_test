<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Order #{{ order.id }} — Admin</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
  <link rel="icon" href="{{ url_for('static', filename='images/logo.png') }}" type="image/png">
  <meta name="theme-color" content="#0b3d2e">
</head>
<body>
  {% include 'navbar.html' %}

  <main class="container py-5">
    <h3 class="mb-3">Order #{{ order.id }}</h3>

    <div class="row">
      <div class="col-md-8">
        <div class="card mb-4">
          <div class="card-body">
            <h6 class="card-title">Customer</h6>
            <p class="mb-1"><strong>Name:</strong> {{ order.customer_name or order.customer_name }}</p>
            <p class="mb-1"><strong>Email:</strong> {{ order.customer_email or '—' }}</p>
            <p class="mb-0"><strong>Placed:</strong> {{ order.created_at or order.order_created or '—' }}</p>
          </div>
        </div>

        <div class="card mb-4">
          <div class="card-body">
            <h6 class="card-title">Order details</h6>

            <dl class="row">
              <dt class="col-sm-4">Agency</dt>
              <dd class="col-sm-8">{{ order.get('agency_decrypted') or order.get('agency') or '—' }}</dd>

              <dt class="col-sm-4">Authorized officer</dt>
              <dd class="col-sm-8">{{ order.get('authorized_officer_decrypted') or order.get('authorized_officer') or '—' }}</dd>

              <dt class="col-sm-4">Position / clearance</dt>
              <dd class="col-sm-8">{{ order.get('position_clearance_decrypted') or order.get('position_clearance') or '—' }}</dd>

              <dt class="col-sm-4">Contact number</dt>
              <dd class="col-sm-8">{{ order.get('contact_number_decrypted') or order.get('contact_number') or '—' }}</dd>

              <dt class="col-sm-4">PO number</dt>
              <dd class="col-sm-8">{{ order.get('po_number_decrypted') or order.get('po_number') or '—' }}</dd>

              <dt class="col-sm-4">Contract reference</dt>
              <dd class="col-sm-8">{{ order.get('contract_reference_decrypted') or order.get('contract_reference') or '—' }}</dd>

              <dt class="col-sm-4">Funding source</dt>
              <dd class="col-sm-8">{{ order.get('funding_source_decrypted') or order.get('funding_source') or '—' }}</dd>

              <dt class="col-sm-4">Delivery location</dt>
              <dd class="col-sm-8">{{ order.get('delivery_location_decrypted') or order.get('delivery_location') or '—' }}</dd>

              <dt class="col-sm-4">Payment method</dt>
              <dd class="col-sm-8">{{ order.get('payment_method_decrypted') or order.get('payment_method') or '—' }}</dd>

              <dt class="col-sm-4">Official email</dt>
              <dd class="col-sm-8">{{ order.official_email or '—' }}</dd>
            </dl>
          </div>
        </div>

        <div class="card">
          <div class="card-body">
            <h6 class="card-title">Items</h6>
            <ul class="list-group list-group-flush">
              {% for it in items %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <div>
                    <div class="fw-semibold">{{ it.name }}</div>
                    <div class="small text-muted">Qty: {{ it.quantity }} • Unit: ${{ "{:,.2f}".format(it.unit_price) }}</div>
                  </div>
                  <div class="fw-semibold">${{ "{:,.2f}".format(it.quantity * it.unit_price) }}</div>
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card shadow-sm">
          <div class="card-body">
            <h6 class="card-title">Summary</h6>
            <p class="mb-1"><strong>Total:</strong> ${{ "{:,.2f}".format(order.total or 0) }}</p>
            <p class="mb-1"><strong>Status:</strong> {{ order.status }}</p>
            <p class="mb-1"><strong>Export/license status:</strong> {{ order.export_license_status or 'pending' }}</p>

            <form method="post" class="mt-3">
              <div class="mb-2">
                <label class="form-label small">Order status</label>
                <select name="status" class="form-select form-select-sm">
                  {% set cur = order.status or 'placed' %}
                  <option value="placed" {{ 'selected' if cur=='placed' else '' }}>placed</option>
                  <option value="processing" {{ 'selected' if cur=='processing' else '' }}>processing</option>
                  <option value="shipped" {{ 'selected' if cur=='shipped' else '' }}>shipped</option>
                  <option value="cancelled" {{ 'selected' if cur=='cancelled' else '' }}>cancelled</option>
                </select>
              </div>

              <div class="mb-2">
                <label class="form-label small">Export / license</label>
                <select name="export_status" class="form-select form-select-sm">
                  {% set ex = order.export_license_status or 'pending' %}
                  <option value="pending" {{ 'selected' if ex=='pending' else '' }}>pending</option>
                  <option value="processing" {{ 'selected' if ex=='processing' else '' }}>processing</option>
                  <option value="approved" {{ 'selected' if ex=='approved' else '' }}>approved</option>
                  <option value="exempt" {{ 'selected' if ex=='exempt' else '' }}>exempt</option>
                </select>
              </div>

              <div class="d-flex gap-2">
                <button type="submit" class="btn btn-sm btn-primary">Save changes</button>
                <a href="{{ url_for('admin_orders') }}" class="btn btn-sm btn-outline-secondary">Back to orders</a>
              </div>
            </form>

            <!-- existing back button kept for safety -->
            <!-- <a href="{{ url_for('admin_orders') }}" class="btn btn-sm btn-outline-secondary mt-3">Back to orders</a> -->
          </div>
        </div>
      </div>
    </div>

  </main>

  <footer class="site-footer border-top py-4 mt-5">
    <div class="container text-center">
      <p class="mb-1">&copy; 2025 Webstore — MachZero</p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>